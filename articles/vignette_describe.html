<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explanations in natural language • ingredients</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Explanations in natural language">
<meta property="og:description" content="ingredients">
<meta property="og:image" content="/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">ingredients</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">1.2.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/vignette_describe.html">Explanations in natural language</a>
    </li>
    <li>
      <a href="../articles/vignette_simulated.html">Simulated data, real problem</a>
    </li>
    <li>
      <a href="../articles/vignette_titanic.html">General introduction: Survival on the RMS Titanic</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/ingredients/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Explanations in natural language</h1>
                        <h4 class="author">Adam Izdebski</h4>
            
            <h4 class="date">2020-04-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/ingredients/blob/master/vignettes/vignette_describe.Rmd"><code>vignettes/vignette_describe.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_describe.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>We adress the problem of insuficient interpretability of explanations for domain experts. We solve this issue by introducing <code><a href="../reference/describe.html">describe()</a></code> function, which automaticly generates natural language descriptions of explanations generated with <code>ingredients</code> package.</p>
</div>
<div id="ingredients-package" class="section level1">
<h1 class="hasAnchor">
<a href="#ingredients-package" class="anchor"></a>ingredients Package</h1>
<p>The <code>ingredients</code> package allows for generating prediction validation and predition perturbation explanations. They allow for both global and local model explanation.</p>
<p>Generic function <code>decribe()</code> generates a natural language description for explanations generated with <code><a href="../reference/feature_importance.html">feature_importance()</a></code>, <code><a href="../reference/ceteris_paribus.html">ceteris_paribus()</a></code> functions.</p>
<p>To show generating automatic descriptions we first load the data set and build a random forest model classifying, which of the passangers survived sinking of the titanic. Then, using <code>DALEX</code> package, we generate an explainer of the model. Lastly we select a random passanger, which prediction’s should be explained.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"DALEX"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"ingredients"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"randomForest"</span>)
<span class="no">titanic</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html">na.omit</a></span>(<span class="no">titanic</span>)

<span class="no">model_titanic_rf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span>(<span class="no">survived</span> <span class="kw">==</span> <span class="st">"yes"</span> ~ <span class="no">.</span>,
                                 <span class="kw">data</span> <span class="kw">=</span> <span class="no">titanic</span>)

<span class="no">explain_titanic_rf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(<span class="no">model_titanic_rf</span>,
                            <span class="kw">data</span> <span class="kw">=</span> <span class="no">titanic</span>[,-<span class="fl">9</span>],
                            <span class="kw">y</span> <span class="kw">=</span> <span class="no">titanic</span>$<span class="no">survived</span> <span class="kw">==</span> <span class="st">"yes"</span>,
                            <span class="kw">label</span> <span class="kw">=</span> <span class="st">"Random Forest"</span>)</pre></body></html></div>
<pre><code>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  Random Forest 
#&gt;   -&gt; data              :  2099  rows  8  cols 
#&gt;   -&gt; target variable   :  2099  values 
#&gt;   -&gt; model_info        :  package randomForest , ver. 4.6.14 , task regression ( [33m default [39m ) 
#&gt;   -&gt; predict function  :  yhat.randomForest  will be used ( [33m default [39m )
#&gt;   -&gt; predicted values  :  numerical, min =  0.005478554 , mean =  0.3240558 , max =  0.9912117  
#&gt;   -&gt; residual function :  difference between y and yhat ( [33m default [39m )
#&gt;   -&gt; residuals         :  numerical, min =  -0.8060092 , mean =  0.0003844283 , max =  0.9039584  
#&gt;  [32m A new explainer has been created! [39m</code></pre>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">passanger</span> <span class="kw">&lt;-</span> <span class="no">titanic</span>[<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">titanic</span>), <span class="fl">1</span>) ,-<span class="fl">9</span>]
<span class="no">passanger</span></pre></body></html></div>
<pre><code>#&gt;      gender age            class    embarked country fare sibsp parch
#&gt; 1601   male  30 engineering crew Southampton England    0     0     0</code></pre>
<p>Now we are ready for generating various explantions and then describing it with <code><a href="../reference/describe.html">describe()</a></code> function.</p>
<div id="feature-importance" class="section level2">
<h2 class="hasAnchor">
<a href="#feature-importance" class="anchor"></a>Feature Importance</h2>
<p>Feature importance explanation shows the importance of all the model’s variables. As it is a global explanation technique, no passanger need to be specified.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">importance_rf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/feature_importance.html">feature_importance</a></span>(<span class="no">explain_titanic_rf</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">importance_rf</span>)</pre></body></html></div>
<p><img src="vignette_describe_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>Function <code><a href="../reference/describe.html">describe()</a></code> easily describes which variables are the most important. Argument <code>nonsignificance_treshold</code> as always sets the level above which variables become significant. For higher treshold, less variables will be described as significant.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/describe.html">describe</a></span>(<span class="no">importance_rf</span>)</pre></body></html></div>
<pre><code>#&gt; The number of important variables for Random Forest's prediction is 5 out of 8. 
#&gt;  Variables gender, class, age have the highest importantance.</code></pre>
</div>
<div id="ceteris-paribus-profiles" class="section level2">
<h2 class="hasAnchor">
<a href="#ceteris-paribus-profiles" class="anchor"></a>Ceteris Paribus Profiles</h2>
<p>Ceteris Paribus profiles shows how the model’s input changes with the change of a specified variable.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">perturbed_variable</span> <span class="kw">&lt;-</span> <span class="st">"class"</span>
<span class="no">cp_rf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(<span class="no">explain_titanic_rf</span>,
                         <span class="no">passanger</span>,
                         <span class="kw">variables</span> <span class="kw">=</span> <span class="no">perturbed_variable</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">cp_rf</span>, <span class="kw">variable_type</span> <span class="kw">=</span> <span class="st">"categorical"</span>)</pre></body></html></div>
<p><img src="vignette_describe_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>For a user with no experience, interpreting the above plot may be not straightforward. Thus we generate a natural language description in order to make it easier.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/describe.html">describe</a></span>(<span class="no">cp_rf</span>)</pre></body></html></div>
<pre><code>#&gt; For the selected instance, prediction estimated by Random Forest is equal to 0.246.
#&gt; 
#&gt; Model's prediction would increase substantially if the value of class variable would change to "deck crew", "1st". On the other hand, Random Forest's prediction would decrease substantially if the value of class variable would change to "restaurant staff", "3rd". The largest change would be marked if class variable would change to "deck crew".
#&gt; 
#&gt; Other variables are with less importance and they do not change prediction by more than 0.05%.</code></pre>
<p>Natural lannguage descriptions should be flexible in order to provide the desired level of complexity and specificity. Thus various parameters can modify the description being generated.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/describe.html">describe</a></span>(<span class="no">cp_rf</span>,
         <span class="kw">display_numbers</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">label</span> <span class="kw">=</span> <span class="st">"the probability that the passanger will survive"</span>)</pre></body></html></div>
<pre><code>#&gt; Random Forest predicts that for the selected instance, the probability that the passanger will survive is equal to 0.246
#&gt; 
#&gt; The most important change in Random Forest's prediction would occur for class = "deck crew". It increases the prediction by 0.312. 
#&gt; The second most important change in the prediction would occur for class = "restaurant staff". It decreases the prediction by 0.171. 
#&gt; The third most important change in the prediction would occur for class = "1st". It increases the prediction by 0.084.
#&gt; 
#&gt; Other variable values are with less importance. They do not change the the probability that the passanger will survive by more than 0.074.</code></pre>
<p>Please note, that <code><a href="../reference/describe.html">describe()</a></code> can handle only one variable at a time, so it is recommended to specify, which variables should be described.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/describe.html">describe</a></span>(<span class="no">cp_rf</span>,
         <span class="kw">display_numbers</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">label</span> <span class="kw">=</span> <span class="st">"the probability that the passanger will survive"</span>,
         <span class="kw">variables</span> <span class="kw">=</span> <span class="no">perturbed_variable</span>)</pre></body></html></div>
<pre><code>#&gt; Random Forest predicts that for the selected instance, the probability that the passanger will survive is equal to 0.246
#&gt; 
#&gt; The most important change in Random Forest's prediction would occur for class = "deck crew". It increases the prediction by 0.312. 
#&gt; The second most important change in the prediction would occur for class = "restaurant staff". It decreases the prediction by 0.171. 
#&gt; The third most important change in the prediction would occur for class = "1st". It increases the prediction by 0.084.
#&gt; 
#&gt; Other variable values are with less importance. They do not change the the probability that the passanger will survive by more than 0.074.</code></pre>
<p>Continuous variables are described as well.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">perturbed_variable_continuous</span> <span class="kw">&lt;-</span> <span class="st">"age"</span>
<span class="no">cp_rf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(<span class="no">explain_titanic_rf</span>,
                         <span class="no">passanger</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">cp_rf</span>, <span class="kw">variables</span> <span class="kw">=</span> <span class="no">perturbed_variable_continuous</span>)</pre></body></html></div>
<p><img src="vignette_describe_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="../reference/describe.html">describe</a></span>(<span class="no">cp_rf</span>, <span class="kw">variables</span> <span class="kw">=</span> <span class="no">perturbed_variable_continuous</span>)</pre></body></html></div>
<pre><code>#&gt; Random Forest predicts that for the selected instance, prediction is equal to 0.246
#&gt; 
#&gt; The highest prediction occurs for (age = 2), while the lowest for (age = 48).
#&gt; Breakpoint is identified at (age = 9).
#&gt; 
#&gt; Average model responses are *higher* for variable values *lower* than breakpoint (= 9).</code></pre>
<p>Ceteris Paribus profiles are described only for a single observation. If we want to access the influence of more than one observation, we need to describe dependence profiles.</p>
</div>
<div id="partial-dependence-profiles" class="section level2">
<h2 class="hasAnchor">
<a href="#partial-dependence-profiles" class="anchor"></a>Partial Dependence Profiles</h2>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">pdp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/aggregate_profiles.html">aggregate_profiles</a></span>(<span class="no">cp_rf</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"partial"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">pdp</span>, <span class="kw">variables</span> <span class="kw">=</span> <span class="st">"fare"</span>)</pre></body></html></div>
<p><img src="vignette_describe_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="../reference/describe.html">describe</a></span>(<span class="no">pdp</span>, <span class="kw">variables</span> <span class="kw">=</span> <span class="st">"fare"</span>)</pre></body></html></div>
<pre><code>#&gt; Random Forest's mean prediction is equal to 0.246.
#&gt; 
#&gt; The highest prediction occurs for (fare = 0), while the lowest for (fare = 69.11).
#&gt; Breakpoint is identified at (fare = 61.037).
#&gt; 
#&gt; Average model responses are *lower* for variable values *higher* than breakpoint (= 61.037).</code></pre>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">pdp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/aggregate_profiles.html">aggregate_profiles</a></span>(<span class="no">cp_rf</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"partial"</span>, <span class="kw">variable_type</span> <span class="kw">=</span> <span class="st">"categorical"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="no">pdp</span>, <span class="kw">variables</span> <span class="kw">=</span> <span class="no">perturbed_variable</span>)</pre></body></html></div>
<p><img src="vignette_describe_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="../reference/describe.html">describe</a></span>(<span class="no">pdp</span>, <span class="kw">variables</span> <span class="kw">=</span> <span class="no">perturbed_variable</span>)</pre></body></html></div>
<pre><code>#&gt; Random Forest's mean prediction is equal to 0.246.
#&gt; 
#&gt; Model's prediction would increase substantially if the value of class variable would change to "1st". On the other hand, Random Forest's prediction would decrease substantially if the value of class variable would change to "deck crew", "restaurant staff". The largest change would be marked if class variable would change to "victualling crew".
#&gt; 
#&gt; Other variables are with less importance and they do not change prediction by more than 0.05%.</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Przemyslaw Biecek, Hubert Baniecki, Adam Izdebski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  


  </body>
</html>

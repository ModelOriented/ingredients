<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explanations in natural language • ingredients</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Explanations in natural language">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
      <a class="navbar-mi2logo" href="http://DrWhy.AI/">
    <img src="https://github.com/ModelOriented/DrWhyTemplate/blob/master/inst/pkgdown/assets/drwhy_znak_violet_small.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
        <a class="navbar-brand" href="../index.html">ingredients</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.3.9</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Describing-Explanations.html">Explanations in natural language</a>
    </li>
    <li>
      <a href="../articles/vignette_titanic.html">General introduction: Survival on the RMS Titanic</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/ingredients">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Explanations in natural language</h1>
                        <h4 class="author">Adam Izdebski</h4>
            
            <h4 class="date">2019-08-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/ingredients/blob/master/vignettes/Describing-Explanations.Rmd"><code>vignettes/Describing-Explanations.Rmd</code></a></small>
      <div class="hidden name"><code>Describing-Explanations.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>We adress the problem of insuficient interpretability of explanations for domain experts. We solve this issue by introducing <code><a href="../reference/describe.html">describe()</a></code> function, which automaticly generates natural language descriptions of explanations generated with <code>ingredients</code> package.</p>
</div>
<div id="ingredients-package" class="section level2">
<h2 class="hasAnchor">
<a href="#ingredients-package" class="anchor"></a>ingredients Package</h2>
<p>The <code>ingredients</code> package allows for generating prediction validation and predition perturbation explanations. They allow for both global and local model explanation.</p>
<p>Generic function <code>decribe()</code> generates a natural language description for explanations generated with <code><a href="../reference/feature_importance.html">feature_importance()</a></code>, <code><a href="../reference/ceteris_paribus.html">ceteris_paribus()</a></code> functions.</p>
<p>To show generating automatic descriptions we first load the data set and build a random forest model classifying, which of the passangers survived sinking of the titanic. Then, using <code>DALEX</code> package, we generate an explainer of the model. Lastly we select a random passanger, which prediction’s should be explained.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"DALEX"</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"ingredients"</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"randomForest"</span>)</a>
<a class="sourceLine" id="cb1-4" title="4">titanic &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(titanic)</a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">model_titanic_rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(survived <span class="op">==</span><span class="st"> "yes"</span> <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb1-7" title="7">                                 <span class="dt">data =</span> titanic)</a>
<a class="sourceLine" id="cb1-8" title="8"></a>
<a class="sourceLine" id="cb1-9" title="9">explain_titanic_rf &lt;-<span class="st"> </span><span class="kw">explain</span>(model_titanic_rf,</a>
<a class="sourceLine" id="cb1-10" title="10">                            <span class="dt">data =</span> titanic[,<span class="op">-</span><span class="dv">9</span>],</a>
<a class="sourceLine" id="cb1-11" title="11">                            <span class="dt">y =</span> titanic<span class="op">$</span>survived <span class="op">==</span><span class="st"> "yes"</span>,</a>
<a class="sourceLine" id="cb1-12" title="12">                            <span class="dt">label =</span> <span class="st">"Random Forest"</span>)</a></code></pre></div>
<pre><code>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  Random Forest 
#&gt;   -&gt; data              :  2099  rows  8  cols 
#&gt;   -&gt; target variable   :  2099  values 
#&gt;   -&gt; predict function  :  yhat.randomForest  will be used ([33mdefault[39m)
#&gt;   -&gt; predicted values  :  numerical, min =  0.008741177 , mean =  0.3236862 , max =  0.9910744  
#&gt;   -&gt; residual function :  difference between y and yhat ([33mdefault[39m)
#&gt;   -&gt; residuals         :  numerical, min =  -0.7971273 , mean =  0.0007539639 , max =  0.8932719  
#&gt; [32mA new explainer has been created![39m</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">passanger &lt;-<span class="st"> </span>titanic[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(titanic), <span class="dv">1</span>) ,<span class="op">-</span><span class="dv">9</span>]</a>
<a class="sourceLine" id="cb3-2" title="2">passanger</a></code></pre></div>
<pre><code>#&gt;      gender age            class    embarked country fare sibsp parch
#&gt; 1908   male  43 victualling crew Southampton   Wales    0     0     0</code></pre>
<p>Now we are ready for generating various explantions and then describing it with <code><a href="../reference/describe.html">describe()</a></code> function.</p>
<div id="feature-importance" class="section level3">
<h3 class="hasAnchor">
<a href="#feature-importance" class="anchor"></a>Feature Importance</h3>
<p>Feature importance explanation shows the importance of all the model’s variables. As it is a global explanation technique, no passanger need to be specified.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">importance_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/feature_importance.html">feature_importance</a></span>(explain_titanic_rf)</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(importance_rf)</a></code></pre></div>
<p><img src="Describing-Explanations_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>Function <code><a href="../reference/describe.html">describe()</a></code> easily describes which variables are the most important. Argument <code>nonsignificance_treshold</code> as always sets the level above which variables become significant. For higher treshold, less variables will be described as significant.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="../reference/describe.html">describe</a></span>(importance_rf)</a></code></pre></div>
<pre><code>#&gt; The number of important variables for Random Forest's prediction is 5 out of 8. 
#&gt;  Variables gender, class, age have the highest importantance.</code></pre>
</div>
<div id="ceteris-paribus-profiles" class="section level3">
<h3 class="hasAnchor">
<a href="#ceteris-paribus-profiles" class="anchor"></a>Ceteris Paribus Profiles</h3>
<p>Ceteris Paribus profiles shows how the model’s input changes with the change of a specified variable.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">perturbed_variable &lt;-<span class="st"> "class"</span></a>
<a class="sourceLine" id="cb8-2" title="2">cp_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explain_titanic_rf,</a>
<a class="sourceLine" id="cb8-3" title="3">                         passanger,</a>
<a class="sourceLine" id="cb8-4" title="4">                         <span class="dt">variables =</span> perturbed_variable)</a>
<a class="sourceLine" id="cb8-5" title="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(cp_rf, <span class="dt">variable_type =</span> <span class="st">"categorical"</span>)</a></code></pre></div>
<p><img src="Describing-Explanations_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>For a user with no experience, interpreting the above plot may be not straightforward. Thus we generate a natural language description in order to make it easier.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="../reference/describe.html">describe</a></span>(cp_rf)</a></code></pre></div>
<pre><code>#&gt; For the selected instance, prediction estimated by Random Forest is equal to 0.126.
#&gt; 
#&gt; Model's prediction would increase substantially if the value of class variable would change to "deck crew", "1st". On the other hand, Random Forest's prediction would decrease substantially if the value of class variable would change to "restaurant staff". The largest change would be marked if class variable would change to "deck crew".
#&gt; 
#&gt; Other variables are with less importance and they do not change prediction by more than 0.05%.</code></pre>
<p>Natural lannguage descriptions should be flexible in order to provide the desired level of complexity and specificity. Thus various parameters can modify the description being generated.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="../reference/describe.html">describe</a></span>(cp_rf,</a>
<a class="sourceLine" id="cb11-2" title="2">         <span class="dt">display_numbers =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb11-3" title="3">         <span class="dt">label =</span> <span class="st">"the probability that the passanger will survive"</span>)</a></code></pre></div>
<pre><code>#&gt; Random Forest predicts that for the selected instance, the probability that the passanger will survive is equal to 0.126
#&gt; 
#&gt; The most important change in Random Forest's prediction would occur for class = "deck crew". It increases the prediction by 0.322. 
#&gt; The second most important change in the prediction would occur for class = "1st". It increases the prediction by 0.119. 
#&gt; The third most important change in the prediction would occur for class = "restaurant staff". It decreases the prediction by 0.056.
#&gt; 
#&gt; Other variable values are with less importance. They do not change the the probability that the passanger will survive by more than 0.031.</code></pre>
<p>Please note, that <code><a href="../reference/describe.html">describe()</a></code> can handle only one variable at a time, so it is recommended to specify, which variables should be described.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="../reference/describe.html">describe</a></span>(cp_rf,</a>
<a class="sourceLine" id="cb13-2" title="2">         <span class="dt">display_numbers =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb13-3" title="3">         <span class="dt">label =</span> <span class="st">"the probability that the passanger will survive"</span>,</a>
<a class="sourceLine" id="cb13-4" title="4">         <span class="dt">variables =</span> perturbed_variable)</a></code></pre></div>
<pre><code>#&gt; Random Forest predicts that for the selected instance, the probability that the passanger will survive is equal to 0.126
#&gt; 
#&gt; The most important change in Random Forest's prediction would occur for class = "deck crew". It increases the prediction by 0.322. 
#&gt; The second most important change in the prediction would occur for class = "1st". It increases the prediction by 0.119. 
#&gt; The third most important change in the prediction would occur for class = "restaurant staff". It decreases the prediction by 0.056.
#&gt; 
#&gt; Other variable values are with less importance. They do not change the the probability that the passanger will survive by more than 0.031.</code></pre>
<p>Continuous variables are described as well.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">perturbed_variable_continuous &lt;-<span class="st"> "age"</span></a>
<a class="sourceLine" id="cb15-2" title="2">cp_rf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ceteris_paribus.html">ceteris_paribus</a></span>(explain_titanic_rf,</a>
<a class="sourceLine" id="cb15-3" title="3">                         passanger)</a>
<a class="sourceLine" id="cb15-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(cp_rf, <span class="dt">variables =</span> perturbed_variable_continuous)</a></code></pre></div>
<p><img src="Describing-Explanations_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1"><span class="kw"><a href="../reference/describe.html">describe</a></span>(cp_rf, <span class="dt">variables =</span> perturbed_variable_continuous)</a></code></pre></div>
<pre><code>#&gt; Random Forest predicts that for the selected instance predicts that , prediction is equal to 0.126.
#&gt; 
#&gt; The highest prediction occurs for (age = 2), while the lowest for (age = 48).
#&gt; Breakpoint is identified at (age = 13).
#&gt; 
#&gt; Average model responses are *higher* for variable values *lower* than breakpoint (= 13).</code></pre>
<p>Ceteris Paribus profiles are described only for a single observation. If we want to access the influence of more than one observation, we need to describe dependency profiles.</p>
</div>
<div id="partial-dependency-profiles" class="section level3">
<h3 class="hasAnchor">
<a href="#partial-dependency-profiles" class="anchor"></a>Partial Dependency Profiles</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">pdp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aggregate_profiles.html">aggregate_profiles</a></span>(cp_rf, <span class="dt">type =</span> <span class="st">"partial"</span>)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(pdp, <span class="dt">variables =</span> <span class="st">"fare"</span>)</a></code></pre></div>
<p><img src="Describing-Explanations_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw"><a href="../reference/describe.html">describe</a></span>(pdp, <span class="dt">variables =</span> <span class="st">"fare"</span>)</a></code></pre></div>
<pre><code>#&gt; Random Forest's mean prediction is equal to 0.126.
#&gt; 
#&gt; The highest prediction occurs for (fare = 30.1), while the lowest for (fare = 14.1).
#&gt; Breakpoints are identified at (fare = 39.12 and fare = 7.141).
#&gt; 
#&gt; Average model responses are *higher* for variable values *higher* than breakpoint (= 7.141).</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">pdp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aggregate_profiles.html">aggregate_profiles</a></span>(cp_rf, <span class="dt">type =</span> <span class="st">"partial"</span>, <span class="dt">variable_type =</span> <span class="st">"categorical"</span>)</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(pdp, <span class="dt">variables =</span> perturbed_variable)</a></code></pre></div>
<p><img src="Describing-Explanations_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw"><a href="../reference/describe.html">describe</a></span>(pdp, <span class="dt">variables =</span> perturbed_variable)</a></code></pre></div>
<pre><code>#&gt; Random Forest's mean prediction is equal to 0.126.
#&gt; 
#&gt; Model's prediction would increase substantially if the value of class variable would change to "1st", "3rd". On the other hand, Random Forest's prediction would decrease substantially if the value of class variable would change to "deck crew", "restaurant staff". The largest change would be marked if class variable would change to "3rd".
#&gt; 
#&gt; Other variables are with less importance and they do not change prediction by more than 0.05%.</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#ingredients-package">ingredients Package</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="author">
  <p>
    Developed by Przemyslaw Biecek, Hubert Baniecki, Adam Izdebski, Katarzyna Pekala.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vignette for aspect importance • ingredients</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Vignette for aspect importance">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
      <a class="navbar-mi2logo" href="http://DrWhy.AI/">
    <img src="https://github.com/ModelOriented/DrWhyTemplate/blob/master/inst/pkgdown/assets/drwhy_znak_violet_small.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
        <a class="navbar-brand" href="../index.html">ingredients</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">0.3.8</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Describing-Explanations.html">Describing-Explanations</a>
    </li>
    <li>
      <a href="../articles/vignette_aspect_importance.html">Vignette for aspect importance</a>
    </li>
    <li>
      <a href="../articles/vignette_titanic.html">Survival on the RMS Titanic</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Vignette for aspect importance</h1>
                        <h4 class="author">Katarzyna Pękala</h4>
            
            <h4 class="date">2019-08-21</h4>
      
      
      <div class="hidden name"><code>vignette_aspect_importance.Rmd</code></div>

    </div>

    
    
<div id="data-and-logistic-regression-model-for-titanic-survival" class="section level1">
<h1 class="hasAnchor">
<a href="#data-and-logistic-regression-model-for-titanic-survival" class="anchor"></a>Data and logistic regression model for Titanic survival</h1>
<p>Vignette will present the aspect_importance() function on the datasets <em>titanic</em> (available in the <code>DALEX</code> package) and <em>BostonHousing2</em> (from <code>mlbench</code> package).<br>
At the beginning, we download <em>titanic</em> dataset and build logistic regression model.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"DALEX"</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(titanic)</a></code></pre></div>
<pre><code>#&gt;   gender age class    embarked       country  fare sibsp parch survived
#&gt; 1   male  42   3rd Southampton United States  7.11     0     0       no
#&gt; 2   male  13   3rd Southampton United States 20.05     0     2       no
#&gt; 3   male  16   3rd Southampton United States 20.05     1     1       no
#&gt; 4 female  39   3rd Southampton       England 20.05     1     1      yes
#&gt; 5 female  16   3rd Southampton        Norway  7.13     0     0      yes
#&gt; 6   male  25   3rd Southampton United States  7.13     0     0      yes</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">titanic &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/na.fail">na.omit</a></span>(titanic)</a>
<a class="sourceLine" id="cb3-2" title="2">model_titanic_glm &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/glm">glm</a></span>(survived <span class="op">==</span><span class="st"> "yes"</span> <span class="op">~</span><span class="st"> </span>class<span class="op">+</span>gender<span class="op">+</span>age<span class="op">+</span>sibsp<span class="op">+</span>parch<span class="op">+</span>fare<span class="op">+</span>embarked,</a>
<a class="sourceLine" id="cb3-3" title="3">               titanic, <span class="dt">family =</span> <span class="st">"binomial"</span>)</a></code></pre></div>
</div>
<div id="preparing-additional-parameters" class="section level1">
<h1 class="hasAnchor">
<a href="#preparing-additional-parameters" class="anchor"></a>Preparing additional parameters</h1>
<p>Before using aspect_importance() we need to:</p>
<ul>
<li>group features of the dataset into aspects,</li>
<li>define the size of the sample that will allow us to calculate aspect importance,</li>
<li>choose observation for which we explain aspects’ importance.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">aspects &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">wealth =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"class"</span>, <span class="st">"fare"</span>), <span class="dt">family =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"sibsp"</span>, <span class="st">"parch"</span>), <span class="dt">personal =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"age"</span>,<span class="st">"gender"</span>), <span class="dt">embarked =</span> <span class="st">"embarked"</span>)</a>
<a class="sourceLine" id="cb4-2" title="2"></a>
<a class="sourceLine" id="cb4-3" title="3">B &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb4-4" title="4">passenger &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="dt">class =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="st">"1st"</span>, <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"1st"</span>, <span class="st">"2nd"</span>, <span class="st">"3rd"</span>, <span class="st">"deck crew"</span>, <span class="st">"engineering crew"</span>, <span class="st">"restaurant staff"</span>, <span class="st">"victualling crew"</span>)),</a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="dt">gender =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="st">"male"</span>, <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"female"</span>, <span class="st">"male"</span>)),</a>
<a class="sourceLine" id="cb4-7" title="7">  <span class="dt">age =</span> <span class="dv">8</span>,</a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="dt">sibsp =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="dt">parch =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb4-10" title="10">  <span class="dt">fare =</span> <span class="dv">72</span>,</a>
<a class="sourceLine" id="cb4-11" title="11">  <span class="dt">embarked =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(<span class="st">"Southampton"</span>, <span class="dt">levels =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Belfast"</span>, <span class="st">"Cherbourg"</span>, <span class="st">"Queenstown"</span>, <span class="st">"Southampton"</span>))</a>
<a class="sourceLine" id="cb4-12" title="12">)</a>
<a class="sourceLine" id="cb4-13" title="13">passenger</a></code></pre></div>
<pre><code>#&gt;   class gender age sibsp parch fare    embarked
#&gt; 1   1st   male   8     0     0   72 Southampton</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(model_titanic_glm, passenger)</a></code></pre></div>
<pre><code>#&gt;         1 
#&gt; 0.6724878</code></pre>
</div>
<div id="calculating-aspect-importance-logistic-regression" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-aspect-importance-logistic-regression" class="anchor"></a>Calculating aspect importance (logistic regression)</h1>
<p>We call aspect_importance() function and see that features that are included in <strong>wealth</strong> (that is <em>class</em> and <em>fare</em>) have the biggest postive contribution on survival prediction for the passenger. Port of <strong>embarkment</strong> (only one feature in this group) has much smaller influence and is of a negative type. <strong>Personal</strong> (<em>gender</em>, <em>age</em>) features as well as <strong>family</strong> features (<em>sibsp</em>, <em>parch</em>) have sligthly positive influence.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"ggplot2"</span>)</a>
<a class="sourceLine" id="cb8-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"ingredients"</span>)</a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4">titanic_glm_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(model_titanic_glm, titanic, predict, passenger, aspects, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6">titanic_glm_ai</a></code></pre></div>
<pre><code>#&gt;    aspects importance
#&gt; 2   wealth  1.2137731
#&gt; 5 embarked -0.2930328
#&gt; 4 personal  0.1834507
#&gt; 3   family  0.1557833</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(titanic_glm_ai) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Aspect importance for the selected passenger (logistic reg.)"</span>)</a></code></pre></div>
<p><img src="vignette_aspect_importance_files/figure-html/Calculating%20aspect%20importance%20(logistic%20regression)-1.png" width="700"></p>
</div>
<div id="calculating-aspect-importance-with-explainer" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-aspect-importance-with-explainer" class="anchor"></a>Calculating aspect importance with explainer</h1>
<p>Aspect_importance() could be also called using <code>DALEX</code> explainer as showed below.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">explain_titanic_glm &lt;-<span class="st"> </span><span class="kw">explain</span>(model_titanic_glm, </a>
<a class="sourceLine" id="cb11-2" title="2">                      <span class="dt">data =</span> titanic[,<span class="op">-</span><span class="dv">9</span>],</a>
<a class="sourceLine" id="cb11-3" title="3">                      <span class="dt">y =</span> titanic<span class="op">$</span>survived <span class="op">==</span><span class="st"> "yes"</span>, </a>
<a class="sourceLine" id="cb11-4" title="4">                      <span class="dt">predict_function =</span> predict,</a>
<a class="sourceLine" id="cb11-5" title="5">                      <span class="dt">label =</span> <span class="st">"Logistic Regression"</span>)</a></code></pre></div>
<pre><code>#&gt; Preparation of a new explainer is initiated
#&gt;   -&gt; model label       :  Logistic Regression 
#&gt;   -&gt; data              :  2099  rows  8  cols 
#&gt;   -&gt; target variable   :  2099  values 
#&gt;   -&gt; predict function  :  predict 
#&gt;   -&gt; predicted values  :  numerical, min =  -4.691272 , mean =  -0.927826 , max =  3.916524  
#&gt;   -&gt; residual function :  difference between y and yhat ([33mdefault[39m)
#&gt;   -&gt; residuals         :  numerical, min =  -3.244117 , mean =  1.252266 , max =  4.691272  
#&gt; [32mA new explainer has been created![39m</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">titanic_glm_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(explain_titanic_glm, passenger, aspects, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb13-2" title="2">titanic_glm_ai</a></code></pre></div>
<pre><code>#&gt;    aspects importance
#&gt; 2   wealth  1.2137731
#&gt; 5 embarked -0.2930328
#&gt; 4 personal  0.1834507
#&gt; 3   family  0.1557833</code></pre>
<p>We can add additional information (ie. list of features that are included in every aspect) by calling add_additional_information().</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1"><span class="kw"><a href="../reference/add_additional_information.html">add_additional_information</a></span>(titanic_glm_ai, explain_titanic_glm<span class="op">$</span>data, aspects)</a></code></pre></div>
<pre><code>#&gt;    aspects importance     features
#&gt; 2   wealth     1.2138  class, fare
#&gt; 5 embarked    -0.2930     embarked
#&gt; 4 personal     0.1835  age, gender
#&gt; 3   family     0.1558 sibsp, parch</code></pre>
</div>
<div id="random-forest-model-for-titanic-survival" class="section level1">
<h1 class="hasAnchor">
<a href="#random-forest-model-for-titanic-survival" class="anchor"></a>Random forest model for Titanic survival</h1>
<p>Secondly, we prepare random forest model for the <em>titanic</em> dataset.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(<span class="st">"randomForest"</span>)</a>
<a class="sourceLine" id="cb17-2" title="2">model_titanic_rf &lt;-<span class="st"> </span><span class="kw">randomForest</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/factor">factor</a></span>(survived) <span class="op">==</span><span class="st"> "yes"</span> <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age <span class="op">+</span><span class="st"> </span>class <span class="op">+</span><span class="st"> </span>embarked <span class="op">+</span></a>
<a class="sourceLine" id="cb17-3" title="3"><span class="st">                                   </span>fare <span class="op">+</span><span class="st"> </span>sibsp <span class="op">+</span><span class="st"> </span>parch,  <span class="dt">data =</span> titanic)</a></code></pre></div>
</div>
<div id="calculating-aspect-importance-random-forest" class="section level1">
<h1 class="hasAnchor">
<a href="#calculating-aspect-importance-random-forest" class="anchor"></a>Calculating aspect importance (random forest)</h1>
<p>After calling aspect_importance() on the random forest model, we can observe that this time every aspect has much smaller contribution to the prediction. We can notice as well that <strong>personal</strong> features have a little big more influence than <strong>wealth</strong>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">titanic_rf_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(model_titanic_rf, titanic, predict, passenger, aspects, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3">titanic_rf_ai</a></code></pre></div>
<pre><code>#&gt;    aspects   importance
#&gt; 4 personal  0.096432565
#&gt; 2   wealth  0.074228802
#&gt; 5 embarked -0.019336815
#&gt; 3   family -0.004678786</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(titanic_rf_ai) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Aspect importance for the selected passenger (random for.)"</span>)</a></code></pre></div>
<p><img src="vignette_aspect_importance_files/figure-html/Calculating%20aspect%20importance%20(random%20forest)-1.png" width="700"></p>
</div>
<div id="automated-grouping-features-into-aspects" class="section level1">
<h1 class="hasAnchor">
<a href="#automated-grouping-features-into-aspects" class="anchor"></a>Automated grouping features into aspects</h1>
<p>On <em>BostonHousing2</em> dataset, we will test function that automatically groups features into aspects (grouping is based on the features correlation). Function only works on continuous variables.</p>
<p>We are importing <em>BostonHousing2</em> from <code>mlbench</code> package and choose columns with continuous features. Then we fit linear model to the data and choose observation to be explained. Target variable is cmedv.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(mlbench)</a>
<a class="sourceLine" id="cb21-2" title="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"BostonHousing2"</span>)</a>
<a class="sourceLine" id="cb21-3" title="3">data &lt;-<span class="st"> </span>BostonHousing2[,<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">10</span>)] <span class="co">#excluding cont. features</span></a>
<a class="sourceLine" id="cb21-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data)</a></code></pre></div>
<pre><code>#&gt;   cmedv    crim zn indus   nox    rm  age    dis rad tax ptratio      b
#&gt; 1  24.0 0.00632 18  2.31 0.538 6.575 65.2 4.0900   1 296    15.3 396.90
#&gt; 2  21.6 0.02731  0  7.07 0.469 6.421 78.9 4.9671   2 242    17.8 396.90
#&gt; 3  34.7 0.02729  0  7.07 0.469 7.185 61.1 4.9671   2 242    17.8 392.83
#&gt; 4  33.4 0.03237  0  2.18 0.458 6.998 45.8 6.0622   3 222    18.7 394.63
#&gt; 5  36.2 0.06905  0  2.18 0.458 7.147 54.2 6.0622   3 222    18.7 396.90
#&gt; 6  28.7 0.02985  0  2.18 0.458 6.430 58.7 6.0622   3 222    18.7 394.12
#&gt;   lstat
#&gt; 1  4.98
#&gt; 2  9.14
#&gt; 3  4.03
#&gt; 4  2.94
#&gt; 5  5.33
#&gt; 6  5.21</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">x &lt;-<span class="st"> </span>BostonHousing2[,<span class="op">-</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">10</span>)] <span class="co">#excluding cont. features and target variable</span></a>
<a class="sourceLine" id="cb23-2" title="2">new_observation &lt;-<span class="st"> </span>data[<span class="dv">10</span>,]</a>
<a class="sourceLine" id="cb23-3" title="3">model &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/lm">lm</a></span>(cmedv <span class="op">~</span>., <span class="dt">data =</span> data)</a>
<a class="sourceLine" id="cb23-4" title="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(model, new_observation)</a></code></pre></div>
<pre><code>#&gt;       10 
#&gt; 19.01352</code></pre>
<p>We run group_variables() function with cutting off level set on 0.6. In result we get a list of variables groups (aspects) where absolute value of features’ pairwise correlation is at least at 0.6.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">aspects_list &lt;-<span class="st"> </span><span class="kw"><a href="../reference/group_variables.html">group_variables</a></span>(x, <span class="fl">0.6</span>)</a>
<a class="sourceLine" id="cb25-2" title="2"></a>
<a class="sourceLine" id="cb25-3" title="3">BostonHousing2_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(model,data, <span class="dt">predict_function =</span> predict,</a>
<a class="sourceLine" id="cb25-4" title="4">                            new_observation,</a>
<a class="sourceLine" id="cb25-5" title="5">                            aspects_list, <span class="dt">B =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb25-6" title="6">BostonHousing2_ai</a></code></pre></div>
<pre><code>#&gt;         aspects importance
#&gt; 4 aspect.group3  -6.249577
#&gt; 2 aspect.group1  -4.912588
#&gt; 5 aspect.group4  -3.203389
#&gt; 6 aspect.group5   3.104578
#&gt; 7 aspect.group6  -2.905689
#&gt; 3 aspect.group2  -2.065514</code></pre>
<p>Finally, we use add_additional_information() function, with parameter <em>show_cor = T</em>, to show how features are grouped into aspects, show minimal value of pairwise correlation in group and show whether any pair of features is negatively correlated (<em>neg</em>) or not (<em>pos</em>).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">BostonHousing2_ai_add &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_additional_information.html">add_additional_information</a></span>(BostonHousing2_ai, data, aspects_list, <span class="dt">show_cor =</span> T)</a>
<a class="sourceLine" id="cb27-2" title="2">BostonHousing2_ai_add</a></code></pre></div>
<pre><code>#&gt;         aspects importance                   features min_cor sign
#&gt; 4 aspect.group3     -6.250                  rm, lstat  0.6408  neg
#&gt; 2 aspect.group1     -4.913 crim, indus, nox, age, dis  0.6795  neg
#&gt; 5 aspect.group4     -3.203                   rad, tax  0.7049  pos
#&gt; 6 aspect.group5      3.105                    ptratio      NA     
#&gt; 7 aspect.group6     -2.906                          b      NA     
#&gt; 3 aspect.group2     -2.066                         zn      NA</code></pre>
</div>
<div id="using-lasso-in-aspect_importance-function" class="section level1">
<h1 class="hasAnchor">
<a href="#using-lasso-in-aspect_importance-function" class="anchor"></a>Using lasso in aspect_importance() function</h1>
<p>Function aspect_importance() can calculate coefficients (that is aspects’ importance) by using either linear regression or lasso regression. Using lasso we can control how many nonzero coefficients are present in final explanation. To use aspect_importance() with lasso we are providing <strong>n_var</strong> parameter.</p>
<p>We are going to use <em>BostonHousing2</em> dataset again. This time we would like to group variables into aspects with a cut off level for correlation set at 0.7.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">aspects_list &lt;-<span class="st"> </span><span class="kw"><a href="../reference/group_variables.html">group_variables</a></span>(x, <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb29-2" title="2">BostonHousing2_ai &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(model,data, <span class="dt">predict_function =</span> predict,</a>
<a class="sourceLine" id="cb29-3" title="3">                            new_observation,</a>
<a class="sourceLine" id="cb29-4" title="4">                            aspects_list, <span class="dt">B =</span> <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb29-5" title="5">BostonHousing2_ai</a></code></pre></div>
<pre><code>#&gt;         aspects    importance
#&gt; 4 aspect.group3 -4.9444618198
#&gt; 9 aspect.group8 -2.6696205434
#&gt; 8 aspect.group7 -2.1264344455
#&gt; 5 aspect.group4 -2.0804767514
#&gt; 7 aspect.group6  1.9580723341
#&gt; 6 aspect.group5 -0.1164860511
#&gt; 2 aspect.group1 -0.0177621592
#&gt; 3 aspect.group2 -0.0003868835</code></pre>
<p>We can see that the importance of some of those groups (1, 2 and 5) is relatively small. With the help of lasso technique, we would like to check the importance of variables’ aspects, while controlling that three of them should be equal to 0.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">BostonHousing2_ai_lasso &lt;-<span class="st"> </span><span class="kw"><a href="../reference/aspect_importance.html">aspect_importance</a></span>(model,data, <span class="dt">predict_function =</span> predict,</a>
<a class="sourceLine" id="cb31-2" title="2">                            new_observation,</a>
<a class="sourceLine" id="cb31-3" title="3">                            aspects_list, <span class="dt">B =</span> <span class="dv">50</span>, <span class="dt">n_var =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb31-4" title="4">BostonHousing2_ai_lasso_add &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_additional_information.html">add_additional_information</a></span>(BostonHousing2_ai_lasso, data, aspects_list, <span class="dt">show_cor =</span> T)</a>
<a class="sourceLine" id="cb31-5" title="5">BostonHousing2_ai_lasso_add</a></code></pre></div>
<pre><code>#&gt;         aspects importance      features min_cor sign
#&gt; 4 aspect.group3   -2.50448 nox, age, dis  0.7952  neg
#&gt; 7 aspect.group6    2.00104       ptratio      NA     
#&gt; 8 aspect.group7   -0.24848             b      NA     
#&gt; 2 aspect.group1    0.21440   crim, indus  0.7355  pos
#&gt; 9 aspect.group8   -0.04586         lstat      NA     
#&gt; 3 aspect.group2    0.00000            zn      NA     
#&gt; 5 aspect.group4    0.00000            rm      NA     
#&gt; 6 aspect.group5    0.00000      rad, tax  0.7049  pos</code></pre>
</div>
<div id="session-info" class="section level1">
<h1 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h1>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/sessionInfo">sessionInfo</a></span>()</a></code></pre></div>
<pre><code>#&gt; R version 3.6.0 (2019-04-26)
#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)
#&gt; Running under: Windows 10 x64 (build 17763)
#&gt; 
#&gt; Matrix products: default
#&gt; 
#&gt; locale:
#&gt; [1] LC_COLLATE=Polish_Poland.1250  LC_CTYPE=Polish_Poland.1250   
#&gt; [3] LC_MONETARY=Polish_Poland.1250 LC_NUMERIC=C                  
#&gt; [5] LC_TIME=Polish_Poland.1250    
#&gt; 
#&gt; attached base packages:
#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base     
#&gt; 
#&gt; other attached packages:
#&gt; [1] mlbench_2.1-1       randomForest_4.6-14 ingredients_0.3.8  
#&gt; [4] ggplot2_3.2.1       DALEX_0.4.6        
#&gt; 
#&gt; loaded via a namespace (and not attached):
#&gt;  [1] Rcpp_1.0.2       compiler_3.6.0   pillar_1.4.2     iterators_1.0.12
#&gt;  [5] tools_3.6.0      digest_0.6.20    lattice_0.20-38  evaluate_0.14   
#&gt;  [9] memoise_1.1.0    tibble_2.1.3     gtable_0.3.0     pkgconfig_2.0.2 
#&gt; [13] rlang_0.4.0      foreach_1.4.7    Matrix_1.2-17    rstudioapi_0.10 
#&gt; [17] commonmark_1.7   yaml_2.2.0       pkgdown_1.3.0    xfun_0.6        
#&gt; [21] withr_2.1.2      stringr_1.4.0    dplyr_0.8.3      roxygen2_6.1.1  
#&gt; [25] xml2_1.2.0       knitr_1.22       desc_1.2.0       fs_1.3.1        
#&gt; [29] glmnet_2.0-18    rprojroot_1.3-2  grid_3.6.0       tidyselect_0.2.5
#&gt; [33] glue_1.3.1       R6_2.4.0         rmarkdown_1.12   purrr_0.3.2     
#&gt; [37] magrittr_1.5     codetools_0.2-16 backports_1.1.4  scales_1.0.0    
#&gt; [41] htmltools_0.3.6  MASS_7.3-51.4    assertthat_0.2.1 colorspace_1.4-1
#&gt; [45] labeling_0.3     stringi_1.4.3    lazyeval_0.2.2   munsell_0.5.0   
#&gt; [49] crayon_1.3.4</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data-and-logistic-regression-model-for-titanic-survival">Data and logistic regression model for Titanic survival</a></li>
      <li><a href="#preparing-additional-parameters">Preparing additional parameters</a></li>
      <li><a href="#calculating-aspect-importance-logistic-regression">Calculating aspect importance (logistic regression)</a></li>
      <li><a href="#calculating-aspect-importance-with-explainer">Calculating aspect importance with explainer</a></li>
      <li><a href="#random-forest-model-for-titanic-survival">Random forest model for Titanic survival</a></li>
      <li><a href="#calculating-aspect-importance-random-forest">Calculating aspect importance (random forest)</a></li>
      <li><a href="#automated-grouping-features-into-aspects">Automated grouping features into aspects</a></li>
      <li><a href="#using-lasso-in-aspect_importance-function">Using lasso in aspect_importance() function</a></li>
      <li><a href="#session-info">Session info</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="author">
  <p>
    Developed by Przemyslaw Biecek, Hubert Baniecki.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>
      </footer>
</div>

  

  </body>
</html>
